{% extends "base.html" %}
{% load staticfiles %}
{% load bootstrap3 %}
{% load common_tags %}

{% block title %}{{ page_title }}{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.9/jquery.csv.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    let table = $('#guests-table').DataTable({
        columns: [{
            "title": "First Name",
            "data": "First"
        }, {
            "title": "Last Name",
            "data": "Last"
        }, {
            "title": "House",
            "data": "House"
        }, {
            "title": "Gender",
            "data": "Gender"
        }]
    });
    $("#fileinput").on("change", function(evt) {
        let f = evt.target.files[0];
        if (f) {
            let r = new FileReader();
            r.onload = function(e) {
                table.rows.add($.csv.toObjects(e.target.result)).draw();
            }
            r.readAsText(f);
        } else {
            alert("Failed to load file");
        }
    });
  });
</script>
{% endblock %}


{% block content %}
<h1>{{page_title}}</h1>
<div class="container">
    <table id="guests-table" class="table table-striped table-bordered" cellspacing="0" width="100%"></table>
    <form action="{% url 'services:process-guests' %}" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="file" id="fileinput" name="fileinput"/>
      <input type="submit" value="Import">
    </form>
</div>

{% endblock %}
