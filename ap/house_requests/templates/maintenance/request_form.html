{% extends "requests/request_tabs.html" %}
{% load staticfiles %}
{% load bootstrap3 %}
{% load common_tags %}
{% bootstrap_messages %}

{% block title %}{{ view.model|model_verbose_name|title }} Form{% endblock %}

{% block references %}
{{ block.super }}
<style type="text/css">
  label[for=id_house] {
    grid-column: 1 / 2;
    grid-row: 2 / 3;
  }

  #id_house {
    grid-column: 1 / 2;
    grid-row: 3 / 4;
  }

  label[for=id_description] {
    grid-column: 3 / 4;
    grid-row: 2 / 3;
  }

  #id_description {
    grid-column: 3 / 4;
    grid-row: 3 / 10;
  }

  label[for=id_room] {
    grid-column: 1 / 2;
    grid-row: 5 / 6;
  }

  #id_room {
    grid-column: 1 / 2;
    grid-row: 6 / 7;
  }

  label[for=id_request_type] {
    grid-column: 1 / 2;
    grid-row: 8 / 9;
  }

  #id_request_type {
    grid-column: 1 / 2;
    grid-row: 9 / 10;
  }
</style>
{% endblock %}

{% block scripts %}
  {{ form.media }}
  <script>
    var rooms = {{ rooms|safe }};
    $(document).ready(() => {
      let room_elem = $('#id_room');
      room_elem.empty();
      $("#id_house").on("change", e => {
        room_elem.empty();
        let house_id = parseInt(e.target.value);
        let new_room_options = rooms.filter(r => r.fields.house == house_id);
        new_room_options.forEach(o => {
          let option = $('<option></option>').attr('value', o.pk)
            .text($("#id_house :selected").text() + ' ' + o.fields.type);
          room_elem.append(option);
        });
        if (['MCC', 'TC'].includes($(e.currentTarget).find('option:selected').text())) {
          room_elem.attr("disabled", true);
        } else {
          room_elem.attr("disabled", false);
        }
      });
      $('#id_description').removeAttr("style");
    });
  </script>
{% endblock %}

{% block request_form %}
  <div class="grid">
    {{ form.house.label_tag }}
    {{ form.house }}

    {{ form.room.label_tag }}
    {{ form.room }}

    {{ form.request_type.label_tag }}
    {{ form.request_type }}

    {{ form.description.label_tag }}
    {{ form.description }}
  </div>

  {{ form.urgent }} Urgent
{% endblock %}

{% block extra_form_elements %}
  <div class="alert alert-warning">
    <p>Please note that routine maintenance requests are usually serviced on Saturdays.</p>
    <p>
      For an emergency, please call:
      <ul>
        <li>John Blatz (714) 493-0037</li>
        <li>Solomon Leung (714) 863-5082</li>
        <li>Vu Tran (714) 270-3064</li>
      </ul>
    </p>
  </div>
{% endblock %}
